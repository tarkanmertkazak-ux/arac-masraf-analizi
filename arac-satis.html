<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Araç Satış Bilgisi</title>

<script src="cars-data.js"></script>

<style>
body{
  font-family:Arial;
  background:#f7f7f7;
  margin:0;
  padding:30px;
}

.box{
  background:#fff;
  max-width:600px;
  margin:auto;
  padding:20px;
  border-radius:10px;
}

h2{text-align:center}

select,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:15px;
}

button{
  cursor:pointer;
  background:#3498db;
  border:none;
  color:#fff;
  border-radius:6px;
}

button:disabled{
  background:#ccc;
}

.note{
  margin-top:10px;
  color:#666;
  font-size:14px;
}
</style>
</head>

<body>

<div class="box">
  <h2>Daha Önce Sattığın Araç</h2>

  <select id="marka">
    <option value="">Marka Seç</option>
  </select>

  <select id="model" disabled>
    <option value="">Model Seç</option>
  </select>

  <select id="kasa" disabled>
    <option value="">Kasa / Yıl Seç</option>
  </select>

  <select id="motor" disabled>
    <option value="">Motor Seç</option>
  </select>

  <select id="satisGun" disabled>
    <option value="">Kaç Günde Satıldı?</option>
    <option value="0-15">0–15 gün</option>
    <option value="15-30">15–30 gün</option>
    <option value="30+">30+ gün</option>
  </select>

  <button id="kaydetBtn" disabled>Kaydet ve Devam Et</button>

  <div class="note">
    Bu bilgi sadece bir kez alınır ve anonim istatistiklerde kullanılır.
  </div>
</div>

<script>
// === GİRİŞ KONTROL ===
if(!localStorage.getItem("userEmail")){
  window.location.href="index.html";
}

// === TEK SEFERLİK KONTROL ===
if(localStorage.getItem("satisBilgisiGirildi")){
  window.location.href="arac-sec.html";
}

// === USER ===
let userId = localStorage.getItem("userId");
if(!userId){
  userId="u_"+Math.random().toString(36).substr(2,9);
  localStorage.setItem("userId",userId);
}

// === ELEMENTLER ===
const markaSel = document.getElementById("marka");
const modelSel = document.getElementById("model");
const kasaSel  = document.getElementById("kasa");
const motorSel = document.getElementById("motor");
const satisSel = document.getElementById("satisGun");
const kaydetBtn= document.getElementById("kaydetBtn");

// === MARKALAR ===
Object.keys(CAR_DATA).forEach(m=>{
  const o=document.createElement("option");
  o.value=m; o.textContent=m;
  markaSel.appendChild(o);
});

// === MARKA ===
markaSel.onchange=()=>{
  reset(modelSel,"Model Seç");
  reset(kasaSel,"Kasa / Yıl Seç");
  reset(motorSel,"Motor Seç");
  reset(satisSel,"Kaç Günde Satıldı?");
  kaydetBtn.disabled=true;

  const marka=markaSel.value;
  if(!marka) return;

  modelSel.disabled=false;
  Object.keys(CAR_DATA[marka]).forEach(model=>{
    const o=document.createElement("option");
    o.value=model; o.textContent=model;
    modelSel.appendChild(o);
  });
};

// === MODEL ===
modelSel.onchange=()=>{
  reset(kasaSel,"Kasa / Yıl Seç");
  reset(motorSel,"Motor Seç");
  reset(satisSel,"Kaç Günde Satıldı?");
  kaydetBtn.disabled=true;

  const marka=markaSel.value;
  const model=modelSel.value;
  if(!model) return;

  kasaSel.disabled=false;
  CAR_DATA[marka][model].forEach((k,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=`${k.kasa} (${k.yillar})`;
    kasaSel.appendChild(o);
  });
};

// === KASA ===
kasaSel.onchange=()=>{
  reset(motorSel,"Motor Seç");
  reset(satisSel,"Kaç Günde Satıldı?");
  kaydetBtn.disabled=true;

  const marka=markaSel.value;
  const model=modelSel.value;
  const idx=kasaSel.value;
  if(idx==="") return;

  motorSel.disabled=false;
  CAR_DATA[marka][model][idx].motorlar.forEach((m,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=`${m.hacim} ${m.yakit} (${m.kod})`;
    motorSel.appendChild(o);
  });
};

// === MOTOR ===
motorSel.onchange=()=>{
  satisSel.disabled = motorSel.value==="";
};

// === SATIŞ ===
satisSel.onchange=()=>{
  kaydetBtn.disabled = satisSel.value==="";
};

// === KAYDET ===
kaydetBtn.onclick=()=>{
  const marka=markaSel.value;
  const model=modelSel.value;
  const kasaObj=CAR_DATA[marka][model][kasaSel.value];
  const motorObj=kasaObj.motorlar[motorSel.value];
  const satisGun=satisSel.value;

  const aracKey = `${marka}-${model}-${kasaObj.kasa}-${motorObj.kod}`;

  const satislar = JSON.parse(localStorage.getItem(aracKey+"_satis")) || [];
  satislar.push({ userId, satisGun });
  localStorage.setItem(aracKey+"_satis", JSON.stringify(satislar));

  localStorage.setItem("satisBilgisiGirildi","true");

  window.location.href="arac-sec.html";
};

// === YARDIMCI ===
function reset(sel,text){
  sel.innerHTML=`<option value="">${text}</option>`;
  sel.disabled=true;
}
</script>

</body>
</html>